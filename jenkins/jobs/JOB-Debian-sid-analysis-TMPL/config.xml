<?xml version='1.0' encoding='UTF-8'?>
<project>
  <actions/>
  <description></description>
  <keepDependencies>false</keepDependencies>
  <properties>
    <hudson.plugins.buildblocker.BuildBlockerProperty plugin="build-blocker-plugin@1.7.3">
      <useBuildBlocker>true</useBuildBlocker>
      <blockLevel>UNDEFINED</blockLevel>
      <scanQueueFor>DISABLED</scanQueueFor>
      <blockingJobs></blockingJobs>
    </hudson.plugins.buildblocker.BuildBlockerProperty>
    <jenkins.model.BuildDiscarderProperty>
      <strategy class="hudson.tasks.LogRotator">
        <daysToKeep>-1</daysToKeep>
        <numToKeep>3</numToKeep>
        <artifactDaysToKeep>-1</artifactDaysToKeep>
        <artifactNumToKeep>1</artifactNumToKeep>
      </strategy>
    </jenkins.model.BuildDiscarderProperty>
    <com.sonyericsson.jenkins.plugins.bfa.model.ScannerJobProperty plugin="build-failure-analyzer@1.16.0">
      <doNotScan>false</doNotScan>
    </com.sonyericsson.jenkins.plugins.bfa.model.ScannerJobProperty>
    <com.chikli.hudson.plugin.naginator.NaginatorOptOutProperty plugin="naginator@1.17.1">
      <optOut>false</optOut>
    </com.chikli.hudson.plugin.naginator.NaginatorOptOutProperty>
  </properties>
  <scm class="hudson.scm.NullSCM"/>
  <canRoam>true</canRoam>
  <disabled>false</disabled>
  <blockBuildWhenDownstreamBuilding>false</blockBuildWhenDownstreamBuilding>
  <blockBuildWhenUpstreamBuilding>false</blockBuildWhenUpstreamBuilding>
  <triggers/>
  <concurrentBuild>false</concurrentBuild>
  <builders>
    <hudson.tasks.Shell>
      <command>#!/bin/bash

cat &gt; PROLOGUE &lt;&lt;&quot;EOF&quot;
set -e
ulimit -S -v 24000000

# https://issues.jenkins-ci.org/browse/JENKINS-9671
if [ x$NODE_NAME = &quot;x&quot; ] ; then
  NODE_NAME=master
fi

if [ x$NODE_NAME = xmaster ] ; then
BASEDIR=$WORKSPACE/../../
export PATH=$BASEDIR/JOB-prepare-binaries-$NODE_NAME/workspace/:$PATH
GOTO_CC=debian-builds-goto-cc
GOTO_INSTRUMENT=debian-builds-goto-instrument
CBMC=debian-builds-cbmc
else
BASEDIR=$WORKSPACE/../
export PATH=$BASEDIR/JOB-prepare-binaries-slaves/label/$NODE_NAME/:$PATH
GOTO_CC=debian-builds-goto-cc
GOTO_INSTRUMENT=debian-builds-goto-instrument
CBMC=debian-builds-cbmc
fi

export LC_ALL=&quot;en_GB.UTF-8&quot;
export TMPDIR=$PWD
EOF
</command>
    </hudson.tasks.Shell>
    <hudson.tasks.Shell>
      <command>#!/bin/bash

. PROLOGUE

binaries=goto-binaries.tar.bz2
if [ x$NODE_NAME = &quot;xmaster&quot; ] ; then
  binaries=$BASEDIR/sid-goto-cc-$pkg/workspace/$binaries
fi

if [ ! -f $binaries ] ; then
  touch FAILED
  exit 0
fi
tar xjf $binaries

 # ignore files generated by dh_girepository and linking info
find goto-binaries -type f | \
  grep -v &apos;\.linked$&apos; | grep -v &apos;\.typelib\.so$&apos; &gt; goto-binaries.list
sed -i &apos;/^goto-binaries\/control/d&apos; goto-binaries.list
sed -i &apos;/^goto-binaries\/copyright/d&apos; goto-binaries.list
</command>
    </hudson.tasks.Shell>
    <org.jenkinsci.plugins.conditionalbuildstep.singlestep.SingleConditionalBuilder plugin="conditional-buildstep@1.3.5">
      <condition class="org.jenkins_ci.plugins.run_condition.logic.Not" plugin="run-condition@1.0">
        <condition class="org.jenkins_ci.plugins.run_condition.core.FileExistsCondition">
          <file>FAILED</file>
          <baseDir class="org.jenkins_ci.plugins.run_condition.common.BaseDirectory$Workspace"/>
        </condition>
      </condition>
      <buildStep class="hudson.tasks.Shell">
        <command>#!/bin/bash

. PROLOGUE

export FULLVER=&quot;`grep ^Version: goto-binaries/control | awk &apos;{ print $2 }&apos;`&quot;

ifs=&quot;$IFS&quot;
IFS=&quot;
&quot;

while read f ; do
  echo &quot;To dump: $f&quot;

  /usr/bin/time -f%Us $GOTO_INSTRUMENT --show-symbol-table &quot;$f&quot; | \
    perl -w -e &apos;use strict;
      my @undecl=(); my $sym=undef;
      while(&lt;&gt;) {
        if(/^Symbol\.{6}: (\S+)$/) { $sym=$1; }
        elsif(defined($sym) &amp;&amp; /^Type\.{8}:(.*)$/) { $sym=undef unless ($1 eq &quot; signed int (void)&quot;); }
        elsif(defined($sym) &amp;&amp; /^Location\.{4}: (.+ function .+)$/) { push @undecl, &quot;$sym: $1&quot;; }
      }
      print &quot;$ENV{PKG} $ENV{FULLVER} MISSING PROTOTYPE: $_\n&quot; foreach (@undecl);
      exit scalar(@undecl)&gt;0 ? 1 : 0;&apos; || continue

  ff=&quot;`basename &quot;$f&quot; | sed &apos;s/@/_/g&apos; | sed &apos;s/^-/_/&apos;`&quot;
  if ! /usr/bin/time -f%Us $GOTO_INSTRUMENT --dump-c &quot;$f&quot; &quot;$ff.c&quot; ; then
    mkdir -p failed-binaries/
    cp &quot;$f&quot; failed-binaries/
    touch FAILED
  else
    for i in 1 2 3 4 5 6 7 8 9 ; do
      # make sure there is no &quot;irep&quot; generated anywhere
      if grep -wq &apos;irep&apos; &quot;$ff.c&quot; ; then
        sed -i &apos;s/\&lt;irep(/#irep(/&apos; &quot;$ff.c&quot;
      fi

      if ! /usr/bin/time -f%Us $GOTO_CC -std=gnu99 -c &quot;$ff.c&quot; ; then
        mkdir -p failed-recompile/
        cp &quot;$f&quot; &quot;$ff.c&quot; failed-recompile/
        touch FAILED
        break
      else
        echo -n &quot;$i: &quot;
        if ! /usr/bin/time -f%Us $GOTO_INSTRUMENT --dump-c &quot;$ff.o&quot; &quot;$ff.c&quot; ; then
          touch FAILED
          break
        fi
        cp &quot;$ff.c&quot; &quot;$ff.$i.c&quot;
        ib=$((i - 1))
        if [ $i -gt 1 ] ; then
          if diff &quot;$ff.$ib.c&quot; &quot;$ff.$i.c&quot; &gt; /dev/null ; then
            echo &quot;Convergence at step $ib&quot;
            break
          elif [ $i -eq 9 ] ; then
            echo &quot;No convergence after $i iterations&quot;
            mkdir -p failed-converge/
            diff -u &quot;$ff.$ib.c&quot; &quot;$ff.$i.c&quot; &gt; &quot;failed-converge/$ff.diff&quot; || true
            cp &quot;$f&quot; &quot;$ff.$ib.c&quot; failed-converge/
            sed -i &apos;/^\/\//d&apos; &quot;$ff.$ib.c&quot; &quot;$ff.$i.c&quot;
            diff -u &quot;$ff.$ib.c&quot; &quot;$ff.$i.c&quot; || true
            touch FAILED
          fi
        fi
      fi
    done

    if [ ! -f FAILED ] ; then
      if ! /usr/bin/time -f%Us $GOTO_INSTRUMENT --dump-c --use-system-headers &quot;$f&quot; &quot;$ff.c&quot; ; then
        touch FAILED
      elif ! gcc -std=gnu99 -c &quot;$ff.c&quot; ; then
        mkdir -p failed-recompile/
        cp &quot;$f&quot; &quot;$ff.c&quot; failed-recompile/
        # not fatal for now
        # touch FAILED
      fi
    fi
            
    rm -f &quot;$ff.c&quot; &quot;$ff.o&quot; &quot;$ff.1.c&quot; &quot;$ff.2.c&quot; &quot;$ff.3.c&quot; &quot;$ff.4.c&quot; &quot;$ff.5.c&quot; &quot;$ff.6.c&quot; &quot;$ff.7.c&quot;
    if [ -f FAILED ] ; then
      break
    fi
  fi
done &lt; goto-binaries.list
IFS=&quot;$ifs&quot;</command>
      </buildStep>
      <runner class="org.jenkins_ci.plugins.run_condition.BuildStepRunner$Fail" plugin="run-condition@1.0"/>
    </org.jenkinsci.plugins.conditionalbuildstep.singlestep.SingleConditionalBuilder>
    <org.jenkinsci.plugins.conditionalbuildstep.singlestep.SingleConditionalBuilder plugin="conditional-buildstep@1.3.5">
      <condition class="org.jenkins_ci.plugins.run_condition.logic.Not" plugin="run-condition@1.0">
        <condition class="org.jenkins_ci.plugins.run_condition.core.FileExistsCondition">
          <file>FAILED</file>
          <baseDir class="org.jenkins_ci.plugins.run_condition.common.BaseDirectory$Workspace"/>
        </condition>
      </condition>
      <buildStep class="hudson.tasks.Shell">
        <command>#!/bin/bash

. PROLOGUE

ifs=&quot;$IFS&quot;
IFS=&quot;
&quot;

while read f ; do
  echo &quot;To edit: $f&quot;


  if ! /usr/bin/time -f%Us $GOTO_INSTRUMENT --constant-propagator &quot;$f&quot; &quot;$f.const-prop&quot; ; then
    touch FAILED
    break
  fi
  ff=&quot;`basename &quot;$f&quot; | sed &apos;s/@/_/g&apos; | sed &apos;s/^-/_/&apos;`&quot;
  if ! /usr/bin/time -f%Us $GOTO_INSTRUMENT --dump-c &quot;$f.const-prop&quot; &quot;$ff.c&quot; ; then
    touch FAILED
    break
  fi

  # make sure there is no &quot;irep&quot; generated anywhere
  if grep -wq &apos;irep&apos; &quot;$ff.c&quot; ; then
    sed -i &apos;s/\&lt;irep(/#irep(/&apos; &quot;$ff.c&quot;
  fi
  # For now we know it doesn&apos;t compile as various properties are not dumped as proper C code
  #if ! /usr/bin/time -f%Us $GOTO_CC -std=gnu99 -c &quot;$ff.c&quot; ; then
  #  touch FAILED
  #  break
  #fi


  rm -f &quot;$ff.c&quot; &quot;$ff.o&quot;
done &lt; goto-binaries.list
IFS=&quot;$ifs&quot;</command>
      </buildStep>
      <runner class="org.jenkins_ci.plugins.run_condition.BuildStepRunner$Fail" plugin="run-condition@1.0"/>
    </org.jenkinsci.plugins.conditionalbuildstep.singlestep.SingleConditionalBuilder>
    <org.jenkinsci.plugins.conditionalbuildstep.singlestep.SingleConditionalBuilder plugin="conditional-buildstep@1.3.5">
      <condition class="org.jenkins_ci.plugins.run_condition.logic.Not" plugin="run-condition@1.0">
        <condition class="org.jenkins_ci.plugins.run_condition.core.FileExistsCondition">
          <file>FAILED</file>
          <baseDir class="org.jenkins_ci.plugins.run_condition.common.BaseDirectory$Workspace"/>
        </condition>
      </condition>
      <buildStep class="hudson.tasks.Shell">
        <command>#!/bin/bash

. PROLOGUE

ifs=&quot;$IFS&quot;
IFS=&quot;
&quot;

while read f ; do
  echo &quot;To edit: $f.const-prop&quot;
  race_check=&quot;&quot;
  # --race-check is too broken in that the points-to analysis will consume way too much memory
  # and will introduce invalid objects
  #if $GOTO_INSTRUMENT --list-symbols &quot;$f&quot; | grep -q &apos;^_start void (void)$&apos; ; then
  #  race_check=&quot;--race-check&quot;
  #fi


  if ! /usr/bin/time -f%Us $GOTO_INSTRUMENT \
      --bounds-check \
      --div-by-zero-check \
      --pointer-check \
      --memory-leak-check \
      --signed-overflow-check \
      --unsigned-overflow-check \
      --undefined-shift-check \
      --nan-check \
      --float-overflow-check \
      $race_check \
      &quot;$f.const-prop&quot; &quot;$f.instr.o&quot; ; then
    touch FAILED
    break
  fi
  ff=&quot;`basename &quot;$f&quot; | sed &apos;s/@/_/g&apos; | sed &apos;s/^-/_/&apos;`&quot;
  if ! /usr/bin/time -f%Us $GOTO_INSTRUMENT --dump-c &quot;$f.instr.o&quot; &quot;$ff.c&quot; ; then
    touch FAILED
    break
  fi

  # make sure there is no &quot;irep&quot; generated anywhere
  if grep -wq &apos;irep&apos; &quot;$ff.c&quot; ; then
    sed -i &apos;s/\&lt;irep(/#irep(/&apos; &quot;$ff.c&quot;
  fi
  # For now we know it doesn&apos;t compile as various properties are not dumped as proper C code
  #if ! /usr/bin/time -f%Us $GOTO_CC -std=gnu99 -c &quot;$ff.c&quot; ; then
  #  touch FAILED
  #  break
  #fi


  rm -f &quot;$ff.c&quot; &quot;$ff.o&quot;
done &lt; goto-binaries.list
IFS=&quot;$ifs&quot;</command>
      </buildStep>
      <runner class="org.jenkins_ci.plugins.run_condition.BuildStepRunner$Fail" plugin="run-condition@1.0"/>
    </org.jenkinsci.plugins.conditionalbuildstep.singlestep.SingleConditionalBuilder>
    <org.jenkinsci.plugins.conditionalbuildstep.singlestep.SingleConditionalBuilder plugin="conditional-buildstep@1.3.5">
      <condition class="org.jenkins_ci.plugins.run_condition.logic.Not" plugin="run-condition@1.0">
        <condition class="org.jenkins_ci.plugins.run_condition.core.FileExistsCondition">
          <file>FAILED</file>
          <baseDir class="org.jenkins_ci.plugins.run_condition.common.BaseDirectory$Workspace"/>
        </condition>
      </condition>
      <buildStep class="hudson.tasks.Shell">
        <command>#!/bin/bash

. PROLOGUE

run_cpachecker() {
  local arg=&quot;$1&quot;
  local opts=&quot;$2&quot;

  ff=&quot;`basename &quot;$arg&quot; | sed &apos;s/@/_/g&apos; | sed &apos;s/^-/_/&apos;`&quot;
  if ! /usr/bin/time -f%Us $GOTO_INSTRUMENT --dump-c &quot;$arg&quot; &quot;$ff.c&quot; ; then
    touch FAILED
    return 1
  fi

  ec=0
  /usr/bin/time -v timeout 930 \
    /import/debian-mole/tools-from-svns/cpachecker/CPAchecker.svn/scripts/cpa.sh \
      -timelimit 900 -heap 16000M \
      $opts \
      &quot;$ff.c&quot; 2&gt;&amp;1 | \
    tee &quot;$arg.log&quot;
  ec=${PIPESTATUS[0]}
  if [ $ec -eq 124 ] || [ $ec -eq 137 ] ; then
    echo &quot;TIMEOUT&quot;
    ec=0
  elif [ $ec -ne 0 ] ; then
    mkdir -p failed-cpachecker
    cp &quot;$arg&quot; &quot;$ff.c&quot; failed-cpachecker/
    touch FAILED
  else
    if ! grep -q &quot;^Verification result: TRUE&quot; &quot;$arg.log&quot; ; then
      touch FAILED
    fi
  fi

  return $ec
}

ifs=&quot;$IFS&quot;
IFS=&quot;
&quot;

while read f ; do
  if ! $GOTO_INSTRUMENT --list-symbols &quot;$f&quot; | grep -q &apos;^_start void (void)$&apos; ; then
    continue
  fi

  echo &quot;To verify: $f&quot;

  if ! run_cpachecker &quot;$f&quot; &quot;-policy&quot; ; then
    break
  fi
  
  # overflow cpa breaks
  #if ! run_cpachecker &quot;$f&quot; &quot;-predicateAnalysis&quot; ; then
  #  break
  #fi

done &lt; goto-binaries.list
IFS=&quot;$ifs&quot;</command>
      </buildStep>
      <runner class="org.jenkins_ci.plugins.run_condition.BuildStepRunner$Fail" plugin="run-condition@1.0"/>
    </org.jenkinsci.plugins.conditionalbuildstep.singlestep.SingleConditionalBuilder>
    <org.jenkinsci.plugins.conditionalbuildstep.singlestep.SingleConditionalBuilder plugin="conditional-buildstep@1.3.5">
      <condition class="org.jenkins_ci.plugins.run_condition.logic.Not" plugin="run-condition@1.0">
        <condition class="org.jenkins_ci.plugins.run_condition.core.FileExistsCondition">
          <file>FAILED</file>
          <baseDir class="org.jenkins_ci.plugins.run_condition.common.BaseDirectory$Workspace"/>
        </condition>
      </condition>
      <buildStep class="hudson.tasks.Shell">
        <command>#!/bin/bash

. PROLOGUE

ifs=&quot;$IFS&quot;
IFS=&quot;
&quot;

while read f ; do
  echo &quot;To edit: $f&quot;

  ec=0
  /usr/bin/time -v timeout -k15 900 $GOTO_INSTRUMENT --accelerate --z3 \
    &quot;$f.instr.o&quot; &quot;$f.instr.accel.o&quot; || ec=$?
  rm -f smt2_dec_*
  if [ $ec -eq 124 ] || [ $ec -eq 137 ] ; then
    rm -f &quot;$f.instr.accel.o&quot;
    echo &quot;TIMEOUT&quot;
  elif [ $ec -eq 11 ] ; then
    # Out of memory
    rm -f &quot;$f.instr.accel.o&quot;
  elif [ $ec -ne 0 ] ; then
    mkdir -p failed-accelerate
    cp &quot;$f.instr.o&quot; failed-accelerate/
    touch FAILED
    break
  fi
done &lt; goto-binaries.list
IFS=&quot;$ifs&quot;</command>
      </buildStep>
      <runner class="org.jenkins_ci.plugins.run_condition.BuildStepRunner$Fail" plugin="run-condition@1.0"/>
    </org.jenkinsci.plugins.conditionalbuildstep.singlestep.SingleConditionalBuilder>
    <org.jenkinsci.plugins.conditionalbuildstep.singlestep.SingleConditionalBuilder plugin="conditional-buildstep@1.3.5">
      <condition class="org.jenkins_ci.plugins.run_condition.logic.Not" plugin="run-condition@1.0">
        <condition class="org.jenkins_ci.plugins.run_condition.core.FileExistsCondition">
          <file>FAILED</file>
          <baseDir class="org.jenkins_ci.plugins.run_condition.common.BaseDirectory$Workspace"/>
        </condition>
      </condition>
      <buildStep class="hudson.tasks.Shell">
        <command>#!/bin/bash

. PROLOGUE

run_cbmc() {
  local arg=&quot;$1&quot;
  local opts=&quot;$2&quot;

  ec=0
  /usr/bin/time -v timeout -k15 900 $CBMC --unwind 1 --no-unwinding-assertions $opts &quot;$arg&quot; 2&gt;&amp;1 | \
    tee &quot;$arg.log&quot;
  ec=${PIPESTATUS[0]}
  if [ $ec -eq 124 ] || [ $ec -eq 137 ] ; then
    echo &quot;TIMEOUT&quot;
    ec=0
  elif [ $ec -ne 0 ] ; then
    mkdir -p failed-verify
    cp &quot;$arg&quot; failed-verify/
    touch FAILED
  fi

  rm -f smt2_dec_*

  return $ec
}

ifs=&quot;$IFS&quot;
IFS=&quot;
&quot;

while read f ; do
  if ! $GOTO_INSTRUMENT --list-symbols &quot;$f&quot; | grep -q &apos;^_start void (void)$&apos; ; then
    continue
  fi

  echo &quot;To verify: $f&quot;

  if [ -f &quot;$f.instr.accel.o&quot; ] ; then
    echo &quot;Trying accelerated binary&quot;
    if ! run_cbmc &quot;$f.instr.accel.o&quot; &quot;--z3&quot; ; then
      break
    fi
  fi

  echo &quot;Non-accelerated binary&quot;
  if ! run_cbmc &quot;$f.instr.o&quot; &quot;&quot; ; then
    break
  fi

done &lt; goto-binaries.list
IFS=&quot;$ifs&quot;</command>
      </buildStep>
      <runner class="org.jenkins_ci.plugins.run_condition.BuildStepRunner$Fail" plugin="run-condition@1.0"/>
    </org.jenkinsci.plugins.conditionalbuildstep.singlestep.SingleConditionalBuilder>
    <org.jenkinsci.plugins.conditionalbuildstep.singlestep.SingleConditionalBuilder plugin="conditional-buildstep@1.3.5">
      <condition class="org.jenkins_ci.plugins.run_condition.logic.Not" plugin="run-condition@1.0">
        <condition class="org.jenkins_ci.plugins.run_condition.core.FileExistsCondition">
          <file>FAILED</file>
          <baseDir class="org.jenkins_ci.plugins.run_condition.common.BaseDirectory$Workspace"/>
        </condition>
      </condition>
      <buildStep class="hudson.tasks.Shell">
        <command>#!/bin/bash

# no static-cycles variant at the moment
exit 0

. PROLOGUE

# adapted variant of mole/idiom-search-one.sh

mkdir -p cycles/$PKG

ifs=&quot;$IFS&quot;
IFS=&quot;
&quot;

while read f ; do
  ff=&quot;`basename &quot;$f&quot; | sed &apos;s/@/_/g&apos; | sed &apos;s/^-/_/&apos;`&quot;
  if [ -e cycles/$PKG/$ff ] || [ -e cycles/$PKG/$ff.failed ] ; then
    i=0
    while [ -e cycles/$PKG/$ff.$i ] || [ -e cycles/$PKG/$ff.$i.failed ] ; do
      i=$((i + 1))
    done
    ff=&quot;$ff.$i&quot;
  fi

  echo -n &quot;`date` $f&quot;
  ec=0
  /usr/bin/time -v timeout -k15 900 static-cycles-goto-instrument --static-cycles &quot;$f&quot; &gt; \
    cycles/$PKG/$ff 2&gt;&amp;1 || ec=$?
  if [ $ec -eq 124 ] || [ $ec -eq 137 ] ; then
    echo &quot; TIMEOUT&quot;
    mv cycles/$PKG/$ff cycles/$PKG/$ff.failed
  elif [ $ec -eq 11 ] ; then
    # Out of memory
    echo &quot; OOM&quot;
    mv cycles/$PKG/$ff cycles/$PKG/$ff.failed
  elif [ $ec -ne 0 ] ; then
    echo &quot; FAILED&quot;
    tail -n 50 cycles/$PKG/$ff
    mkdir -p failed-cycles
    cp &quot;$f&quot; failed-cycles/
    touch FAILED
    break
  else
    echo &quot; OK - `grep ^Source: cycles/$PKG/$ff | wc -l` cycles&quot;
  fi
done &lt; goto-binaries.list
IFS=&quot;$ifs&quot;</command>
      </buildStep>
      <runner class="org.jenkins_ci.plugins.run_condition.BuildStepRunner$Fail" plugin="run-condition@1.0"/>
    </org.jenkinsci.plugins.conditionalbuildstep.singlestep.SingleConditionalBuilder>
    <org.jenkinsci.plugins.conditionalbuildstep.singlestep.SingleConditionalBuilder plugin="conditional-buildstep@1.3.5">
      <condition class="org.jenkins_ci.plugins.run_condition.logic.Not" plugin="run-condition@1.0">
        <condition class="org.jenkins_ci.plugins.run_condition.core.FileExistsCondition">
          <file>FAILED</file>
          <baseDir class="org.jenkins_ci.plugins.run_condition.common.BaseDirectory$Workspace"/>
        </condition>
      </condition>
      <buildStep class="hudson.tasks.Shell">
        <command>#!/bin/bash

# no static-cycles variant at the moment
exit 0

. PROLOGUE

MOLE_HOME=/import/debian-mole/tools-from-svns/mole-0.3

$MOLE_HOME/classify-wrapper.sh

# adapted variant of mole/mole.sh

if [ ! -f cycles-proc/$PKG/classify-done ] ; then
  echo &quot;classify failed&quot;
  touch FAILED
  exit 0
fi

DIST=sid
MIRROR=ftp://ftp.uk.debian.org
Sources=/srv/jenkins-slave/workspace/JOB-prepare-binaries-chroots
Sources=&quot;$Sources/label/$NODE_NAME/JOB-Debian-sid/workspace/Sources&quot;


export PKG_VERSION=&quot;`grep ^Version: goto-binaries/control | awk &apos;{ print $2 }&apos;`&quot;

cd cycles-proc/$PKG

mkdir mole-pkg
cd mole-pkg
G=$(grep-dctrl -S -n -s Directory,Version -r ^$PKG$ $Sources | tail -n 3)
set -- $G
DIR=$1
export PKG_VERSION=$2
VER=`echo $PKG_VERSION | sed s/^.*://`
umask 0022; export DEB_VENDOR=Debian; dget -u -x ${MIRROR}/debian/${DIR}/${PKG}_${VER}.dsc
cd ..

cat critical-classified.txt uniproc-classified.txt | \
  cut -f6 -d&apos;;&apos; | sort | uniq -c | sort -gr | \
while read c s ; do
  echo -n &quot;$s | $c | &quot;

  cat critical-classified.txt uniproc-classified.txt | grep &quot;;$s$&quot; | \
    cut -f3-4 -d&apos;;&apos; | $MOLE_HOME/mole-source-transform.pl &gt; sources.txt
  head -n 1 sources.txt

  mv sources.txt mole-source-links-$s.txt
  gzip mole-source-links-$s.txt
done &gt; mole-report.txt

rm -rf mole-pkg</command>
      </buildStep>
      <runner class="org.jenkins_ci.plugins.run_condition.BuildStepRunner$Fail" plugin="run-condition@1.0"/>
    </org.jenkinsci.plugins.conditionalbuildstep.singlestep.SingleConditionalBuilder>
    <org.jenkinsci.plugins.conditionalbuildstep.singlestep.SingleConditionalBuilder plugin="conditional-buildstep@1.3.5">
      <condition class="org.jenkins_ci.plugins.run_condition.logic.Not" plugin="run-condition@1.0">
        <condition class="org.jenkins_ci.plugins.run_condition.core.FileExistsCondition">
          <file>FAILED</file>
          <baseDir class="org.jenkins_ci.plugins.run_condition.common.BaseDirectory$Workspace"/>
        </condition>
      </condition>
      <buildStep class="hudson.tasks.Shell">
        <command>#!/bin/bash

# no static-cycles variant at the moment
exit 0

. PROLOGUE

ifs=&quot;$IFS&quot;
IFS=&quot;
&quot;

while read f ; do
  if ! $GOTO_INSTRUMENT --list-symbols &quot;$f&quot; | grep -q &apos;^_start void (void)$&apos; ; then
    continue
  fi

  ff=&quot;`basename &quot;$f&quot; | sed &apos;s/@/_/g&apos; | sed &apos;s/^-/_/&apos;`&quot;
  if [ -e cycles-proc/$PKG/$ff.spawned-functions.json ] ; then
    i=0
    while [ -e cycles-proc/$PKG/$ff.$i.spawned-functions.json ] ; do
      i=$((i + 1))
    done
    ff=&quot;$ff.$i&quot;
  fi

  echo &quot;Computing spawned functions: $f&quot;

  ec=0
  /usr/bin/time -v timeout -k15 900 static-cycles-goto-instrument --spawned-functions &quot;$f&quot; \
    &gt; cycles-proc/$PKG/$ff.spawned-functions.json \
    2&gt; cycles-proc/$PKG/$ff.spawned-functions-stderr.json || ec=$?
  if [ $ec -eq 124 ] || [ $ec -eq 137 ] ; then
    echo &quot;TIMEOUT&quot;
  elif [ $ec -ne 0 ] ; then
    mkdir -p failed-spawned-functions
    cp &quot;$f&quot; failed-spawned-functions/
    touch FAILED
    if [ -s cycles-proc/$PKG/$ff.spawned-functions-stderr.json ] ; then
      cat cycles-proc/$PKG/$ff.spawned-functions-stderr.json
    fi
    break
  else
    rm -f cycles-proc/$PKG/$ff.spawned-functions-stderr.json
    echo &quot;OK&quot;
  fi

  if [ ! -s cycles-proc/$PKG/$ff.spawned-functions.json ] ; then
    rm -f cycles-proc/$PKG/$ff.spawned-functions.json
  fi

done &lt; goto-binaries.list
IFS=&quot;$ifs&quot;</command>
      </buildStep>
      <runner class="org.jenkins_ci.plugins.run_condition.BuildStepRunner$Fail" plugin="run-condition@1.0"/>
    </org.jenkinsci.plugins.conditionalbuildstep.singlestep.SingleConditionalBuilder>
    <org.jenkinsci.plugins.conditionalbuildstep.singlestep.SingleConditionalBuilder plugin="conditional-buildstep@1.3.5">
      <condition class="org.jenkins_ci.plugins.run_condition.logic.Not" plugin="run-condition@1.0">
        <condition class="org.jenkins_ci.plugins.run_condition.core.FileExistsCondition">
          <file>FAILED</file>
          <baseDir class="org.jenkins_ci.plugins.run_condition.common.BaseDirectory$Workspace"/>
        </condition>
      </condition>
      <buildStep class="hudson.tasks.Shell">
        <command>#!/bin/bash

. PROLOGUE

ifs=&quot;$IFS&quot;
IFS=&quot;
&quot;

PIPE_D=/import/debian-mole/kareem/pipeline

echo Cycles file length: `wc -l cycles-proc/$PKG/critical-classified.txt`

# Ensure that the NFS share is accessible
ls $PIPE_D || true
sleep 1
touch $PIPE_D/foo || true
sync
sleep 1

COUNTER=0

until [ $COUNTER -eq 10 ]  ||  cat $PIPE_D/analyse.rb  $PIPE_D/jenkins-driver.sh  &gt;/dev/null; do
  sleep 1
  let COUNTER+=1
  echo &quot;Trying to read from NFS share: attempt $COUNTER&quot;
done


# If we +still+ can&apos;t read the file after all of that then just die.

if [ $COUNTER -eq 10 ]; then
  echo NFS share inaccessible
  exit 1
fi


# If there are no black-box testers for the package,
# then no need to run the dynamic analysis

echo &quot;Looking for &lt;$PIPE_D/package_specific/$PKG&gt;...&quot;

if [ ! -d $PIPE_D/package_specific/$PKG ]; then
  echo Skipping dynamic analysis
  exit 0
else
  /import/debian-mole/kareem/pipeline/jenkins-driver.sh   goto-binaries.list
fi

IFS=&quot;$ifs&quot;</command>
      </buildStep>
      <runner class="org.jenkins_ci.plugins.run_condition.BuildStepRunner$Fail" plugin="run-condition@1.0"/>
    </org.jenkinsci.plugins.conditionalbuildstep.singlestep.SingleConditionalBuilder>
    <org.jenkinsci.plugins.conditionalbuildstep.singlestep.SingleConditionalBuilder plugin="conditional-buildstep@1.3.5">
      <condition class="org.jenkins_ci.plugins.run_condition.core.FileExistsCondition" plugin="run-condition@1.0">
        <file>FAILED</file>
        <baseDir class="org.jenkins_ci.plugins.run_condition.common.BaseDirectory$Workspace"/>
      </condition>
      <buildStep class="hudson.tasks.Shell">
        <command>#!/bin/bash

. PROLOGUE

[ -d goto-binaries ] || exit 0

ver=&quot;`grep ^Version: goto-binaries/control | awk &apos;{ print $2 }&apos;`&quot;

cat &lt;&lt;EOF
To: submit@bugs.debian.org
Subject: $PKG:

Package: $PKG
Version: $ver
Usertags: goto-cc

During an analysis of all Debian packages using our research compiler tool-chain
(using tools from the cbmc package) the following error was found:

http://sources.debian.net/src/$PKG/$ver/
http://packages.qa.debian.org/$PKG
EOF

rm -f smt2_dec_*
rm -rf goto-binaries goto-binaries.tar.bz2

exit 1</command>
      </buildStep>
      <runner class="org.jenkins_ci.plugins.run_condition.BuildStepRunner$DontRun" plugin="run-condition@1.0"/>
    </org.jenkinsci.plugins.conditionalbuildstep.singlestep.SingleConditionalBuilder>
  </builders>
  <publishers>
    <com.chikli.hudson.plugin.naginator.NaginatorPublisher plugin="naginator@1.17.1">
      <regexpForRerun>.*at hudson\.model\.FreeStyleBuild\.run.*</regexpForRerun>
      <rerunIfUnstable>false</rerunIfUnstable>
      <rerunMatrixPart>false</rerunMatrixPart>
      <checkRegexp>true</checkRegexp>
      <regexpForMatrixStrategy>TestParent</regexpForMatrixStrategy>
      <delay class="com.chikli.hudson.plugin.naginator.ProgressiveDelay">
        <increment>300</increment>
        <max>10800</max>
      </delay>
      <maxSchedule>2</maxSchedule>
    </com.chikli.hudson.plugin.naginator.NaginatorPublisher>
    <hudson.plugins.ws__cleanup.WsCleanup plugin="ws-cleanup@0.29">
      <deleteDirs>false</deleteDirs>
      <skipWhenFailed>false</skipWhenFailed>
      <cleanWhenSuccess>true</cleanWhenSuccess>
      <cleanWhenUnstable>false</cleanWhenUnstable>
      <cleanWhenFailure>false</cleanWhenFailure>
      <cleanWhenNotBuilt>true</cleanWhenNotBuilt>
      <cleanWhenAborted>true</cleanWhenAborted>
      <notFailBuild>false</notFailBuild>
      <cleanupMatrixParent>false</cleanupMatrixParent>
      <externalDelete></externalDelete>
    </hudson.plugins.ws__cleanup.WsCleanup>
  </publishers>
  <buildWrappers>
    <hudson.plugins.ws__cleanup.PreBuildCleanup plugin="ws-cleanup@0.29">
      <deleteDirs>false</deleteDirs>
      <cleanupParameter></cleanupParameter>
      <externalDelete></externalDelete>
    </hudson.plugins.ws__cleanup.PreBuildCleanup>
    <de.jamba.hudson.plugin.wsclean.PrePostClean plugin="hudson-wsclean-plugin@1.0.5">
      <before>true</before>
      <behind>false</behind>
    </de.jamba.hudson.plugin.wsclean.PrePostClean>
    <com.michelin.cio.hudson.plugins.copytoslave.CopyToSlaveBuildWrapper plugin="copy-to-slave@1.4.4">
      <includes></includes>
      <excludes></excludes>
      <flatten>true</flatten>
      <includeAntExcludes>false</includeAntExcludes>
      <hudsonHomeRelative>false</hudsonHomeRelative>
      <relativeTo>somewhereElse</relativeTo>
    </com.michelin.cio.hudson.plugins.copytoslave.CopyToSlaveBuildWrapper>
    <EnvInjectBuildWrapper plugin="envinject@1.92.1">
      <info>
        <loadFilesFromMaster>false</loadFilesFromMaster>
      </info>
    </EnvInjectBuildWrapper>
  </buildWrappers>
</project>